# Azure Voice Chatbot - コスト見積もり

このドキュメントでは、02_azure-voice-chatbotプロジェクトで使用するAzureサービスのコスト見積もりと最適化のベストプラクティスをまとめています。

---

## 📋 使用するAzureサービス

### 1. Azure OpenAI Service (GPT-5)

**料金体系** (2025年1月時点の概算)

| モデル | 入力トークン | 出力トークン |
|--------|-------------|-------------|
| GPT-5 | ~$0.01/1K tokens | ~$0.03/1K tokens |
| GPT-5-mini | ~$0.003/1K tokens | ~$0.009/1K tokens |

**特徴:**
- トークン単位の従量課金
- リージョンによって料金が異なる場合がある
- デプロイメント単位で課金（複数のユーザーが同じデプロイメントを共有可能）

---

### 2. Azure Speech Service

**料金体系** (2025年1月時点の概算)

#### Speech-to-Text (音声認識)
| 機能 | 料金 |
|------|------|
| Standard | ~$1.00/1時間 |
| Neural | ~$2.40/1時間 |

#### Text-to-Speech (音声合成)
| 機能 | 料金 |
|------|------|
| Neural Voice | ~$16.00/1M文字 |
| Standard Voice | ~$4.00/1M文字 |

**特徴:**
- 音声認識は処理時間に応じて課金
- 音声合成は生成された文字数に応じて課金
- 高品質なNeural Voiceを推奨（自然な音声）

---

## 💰 コスト試算

### シナリオ1: ハンズオン利用（2時間、参加者30名）

**前提条件:**
- 1人あたり平均10ターンの会話
- 1ターンあたりユーザー発話10秒、応答文50文字
- GPT-5-miniを使用（コスト削減のため）

**コスト内訳:**

| 項目 | 計算 | コスト |
|------|------|--------|
| **Speech-to-Text** | 30人 × 10ターン × 10秒 = 50分 | $2.00 |
| **Azure OpenAI (入力)** | 30人 × 10ターン × 100トークン × $0.003 | $0.90 |
| **Azure OpenAI (出力)** | 30人 × 10ターン × 50トークン × $0.009 | $1.35 |
| **Text-to-Speech** | 30人 × 10ターン × 50文字 = 15,000文字 | $0.24 |
| **合計** | | **約$4.50** |

**1人あたりコスト: 約$0.15 (約¥22)**

---

### シナリオ2: 小規模実運用（月間1,000セッション）

**前提条件:**
- 1セッションあたり平均20ターンの会話
- 1ターンあたりユーザー発話15秒、応答文80文字
- GPT-5を使用（高品質な応答）

**コスト内訳:**

| 項目 | 計算 | 月額コスト |
|------|------|----------|
| **Speech-to-Text** | 1,000セッション × 20ターン × 15秒 = 83.3時間 | $200.00 |
| **Azure OpenAI (入力)** | 1,000 × 20 × 150トークン × $0.01 | $30.00 |
| **Azure OpenAI (出力)** | 1,000 × 20 × 80トークン × $0.03 | $48.00 |
| **Text-to-Speech** | 1,000 × 20 × 80文字 = 1.6M文字 | $25.60 |
| **合計** | | **約$303.60/月** |

**1セッションあたりコスト: 約$0.30 (約¥45)**

---

### シナリオ3: 中規模実運用（月間10,000セッション）

**前提条件:** シナリオ2と同じ

**コスト内訳:**

| 項目 | 月額コスト |
|------|----------|
| **Speech-to-Text** | $2,000.00 |
| **Azure OpenAI (入力)** | $300.00 |
| **Azure OpenAI (出力)** | $480.00 |
| **Text-to-Speech** | $256.00 |
| **合計** | **約$3,036.00/月** |

**1セッションあたりコスト: 約$0.30 (約¥45)**

---

## 📊 コスト比較: GPT-5 vs GPT-5-mini

| モデル | 応答品質 | 1,000ターンあたりコスト | 推奨用途 |
|--------|---------|------------------------|----------|
| GPT-5 | 高品質 | $3.90 | 本番環境、カスタマーサポート |
| GPT-5-mini | 標準 | $1.17 | ハンズオン、開発・テスト |

**コスト削減効果: GPT-5-miniは約70%のコスト削減**

---

## 🎯 コスト最適化のベストプラクティス

### 1. モデル選択の最適化

#### GPT-5-miniの活用
```python
# ハンズオンや開発環境では GPT-5-mini を使用
session = await create_voice_session(
    agent_name="VoiceAssistant",
    deployment_name="gpt-5-mini"  # コスト削減
)
```

#### 用途別モデル選択
- **ハンズオン/開発**: GPT-5-mini
- **本番環境（高品質）**: GPT-5
- **本番環境（大量処理）**: GPT-5-mini + プロンプト最適化

---

### 2. 会話管理の最適化

#### ターン数制限
```python
# settings.py で適切な上限を設定
MAX_CONVERSATION_TURNS = 50  # 無限ループ防止
MAX_SESSION_DURATION = 1800  # 30分
```

#### 不要な会話の早期終了
- 終了キーワードの適切な設定
- タイムアウトの実装
- セッション時間の制限

---

### 3. 音声処理の最適化

#### Speech-to-Textの最適化
- 無音検出の活用（不要な認識処理を削減）
- タイムアウトの適切な設定
- 再試行回数の制限

#### Text-to-Speechの最適化
- 応答文の簡潔化（システムプロンプトで指示）
- キャッシュ可能な定型文の事前合成
- Neural Voiceの選択的使用

---

### 4. デプロイメントの最適化

#### リージョン選択
- 最も安価なリージョンを選択（ただしレイテンシも考慮）
- 日本向けサービス: Japan East推奨
- グローバル: East US 2などのコスト効率の良いリージョン

#### 予算アラート
Azure Portalで予算アラートを設定：
1. Cost Management + Billing
2. Budgets → 新規予算作成
3. アラート条件を設定（例: 月額$500超過時）

---

### 5. テスト環境のコスト削減

#### モック化の活用
```python
# 開発時はモックを使用してAzure API呼び出しを削減
@pytest.fixture
def mock_speech_sdk():
    with patch('speech.recognizer.speechsdk') as mock:
        yield mock
```

#### ローカルテスト
- ユニットテストは全てモックを使用（Azure APIコール無し）
- 統合テストは最小限に
- 本番相当のテストはCI/CD環境で制限的に実行

---

## 💡 コスト削減の実例

### 例1: ハンズオンでのコスト削減

**変更前（GPT-5使用）:**
- 参加者30名 × 2時間
- コスト: 約$15.00

**変更後（GPT-5-mini使用）:**
- 参加者30名 × 2時間
- コスト: 約$4.50

**削減額: $10.50 (70%削減)**

---

### 例2: 応答文の簡潔化

**変更前（平均100文字/応答）:**
- 1,000セッション × 20ターン × 100文字
- Text-to-Speechコスト: $32.00

**変更後（平均60文字/応答、プロンプト最適化）:**
- 1,000セッション × 20ターン × 60文字
- Text-to-Speechコスト: $19.20

**削減額: $12.80/月 (40%削減)**

---

## 📈 ROI（投資対効果）の試算

### コールセンター自動化の例

**前提条件:**
- 月間10,000件の問い合わせ
- 人件費: オペレーター1名あたり月30万円
- 自動化率: 60%（6,000件をAIが対応）

**コスト比較:**

| 項目 | 従来（人手） | AI自動化 | 削減額 |
|------|------------|---------|--------|
| 人件費 | 600万円 | 240万円 | 360万円 |
| Azureコスト | - | 約30万円 | - |
| **合計** | **600万円** | **270万円** | **330万円/月** |

**投資回収期間: 即時（初期投資ほぼゼロ）**

---

## 🔍 モニタリング・最適化

### コスト監視

**Azure Cost Managementの活用:**
1. サービス別コスト分析
2. タグによるプロジェクト別追跡
3. 予算超過アラート
4. コスト推移のトレンド分析

### 最適化のサイクル

```
計測 → 分析 → 改善 → 計測
  ↑_______________|
```

1. **計測**: Azure Cost Managementで実際のコストを確認
2. **分析**: どのサービスが最もコストがかかっているか特定
3. **改善**: 上記のベストプラクティスを適用
4. **計測**: 改善効果を測定

---

## 📝 まとめ

### コスト概算（再掲）

| 用途 | 規模 | 月額コスト目安 |
|------|------|--------------|
| ハンズオン | 30名 × 2時間 | $4.50 (1回限り) |
| 開発・テスト | 100セッション | $30.00 |
| 小規模実運用 | 1,000セッション | $300.00 |
| 中規模実運用 | 10,000セッション | $3,000.00 |

### 重要なポイント

1. ✅ **GPT-5-miniの活用で70%のコスト削減**
2. ✅ **適切な制限設定で無駄なコストを防止**
3. ✅ **テスト環境ではモックを活用**
4. ✅ **Azure Cost Managementでコスト監視**
5. ✅ **プロンプト最適化で応答文を簡潔化**

### 推奨アクション

- [ ] Azure予算アラートの設定
- [ ] 開発環境でGPT-5-miniを使用
- [ ] モック化されたユニットテストの実装
- [ ] 月次コストレビューの実施
- [ ] ROI試算とビジネスケースの作成

---

**最終更新**: 2025-11-17
**対象プロジェクト**: 02_azure-voice-chatbot (Phase 4)

**注意事項**:
- 本ドキュメントの料金は概算です。最新の料金は[Azure公式サイト](https://azure.microsoft.com/ja-jp/pricing/)でご確認ください。
- 料金はリージョンや契約形態によって異なる場合があります。
- 実際の使用量は想定と異なる可能性があるため、Azure Cost Managementでの監視を推奨します。
